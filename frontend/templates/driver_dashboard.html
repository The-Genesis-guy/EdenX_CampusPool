<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ CampusPool - Help Your Community</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div class="map-first-container">
        <!-- Full Screen Map -->
        <div id="map" class="full-screen-map"></div>
        
        <!-- Floating Header Card -->
        <div class="floating-header">
            <div class="header-content">
                <div class="user-info">
                    <h2 id="user-name">Loading...</h2>
                    <p class="user-role">ğŸŒŸ Active Community Helper</p>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="view-requests-btn" title="View Ride Requests">ğŸ“‹</button>
                    <button class="header-btn" id="notifications-btn">ğŸ’¬</button>
                    <button class="header-btn" id="profile-btn">ğŸ‘¤</button>
                    <button onclick="handleLogout()" class="logout-btn">Logout</button>
                </div>
            </div>
        </div>

        <!-- Floating Helper Status Card -->
        <div class="floating-helper-card" id="helper-card">
            <div class="helper-header">
                <h3>ğŸ¤ Ready to help community?</h3>
                <div class="helper-toggle">
                    <div class="toggle-switch" id="online-toggle">
                        <div class="toggle-slider"></div>
                    </div>
                </div>
            </div>
            
            <div class="helper-status" id="helper-status">
                <div class="status-indicator offline">
                    <span class="status-dot"></span>
                    <span class="status-text">Taking a break</span>
                </div>
            </div>

            <!-- Route Setup (shown when online) -->
            <div class="route-setup hidden" id="route-setup">
                <div class="route-inputs">
                    <div class="location-input-group">
                        <input 
                            type="text" 
                            id="destination-input" 
                            class="location-input" 
                            placeholder="ğŸ¯ I'm going to..."
                            autocomplete="off"
                        >
                        <button id="college-location-btn" class="location-btn" title="Set to college">
                            ğŸ«
                        </button>
                    </div>
                </div>

                <!-- Campus Quick Destinations -->
                <div class="campus-quick-buttons">
                    <button class="quick-btn" data-destination="ğŸ  Home">ğŸ  Home</button>
                    <button class="quick-btn" data-destination="ğŸ« College">ğŸ« College</button>
                </div>

                <div class="helper-details">
                    <div class="detail-group">
                        <label>ğŸ• Leaving:</label>
                        <select id="departure-time" class="time-select">
                            <option value="now">Now</option>
                            <option value="15min">In 15 min</option>
                            <option value="30min">In 30 min</option>
                            <option value="1hour">In 1 hour</option>
                        </select>
                    </div>
                    
                    <div class="detail-group">
                        <label>ğŸ‘¥ Seats:</label>
                        <select id="available-seats" class="time-select">
                            <option value="1">1 available</option>
                            <option value="2">2 available</option>
                            <option value="3">3 available</option>
                        </select>
                    </div>
                </div>

                <div class="helper-message">
                    <label>ğŸ’­ Message to riders:</label>
                    <textarea 
                        id="helper-message" 
                        class="message-input" 
                        placeholder="e.g., 'Heading to mall for lunch!'"
                        maxlength="100"
                        rows="2"
                    ></textarea>
                </div>

                <button id="start-helping-btn" class="btn btn-primary btn-full">
                    ğŸ¤ Start Helping Community
                </button>
            </div>

            <!-- Helper Stats (shown when online) -->
            <div class="helper-stats hidden" id="helper-stats">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">12</div>
                        <div class="stat-label">Rides shared</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">15kg</div>
                        <div class="stat-label">COâ‚‚ saved</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">8</div>
                        <div class="stat-label">New connections</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Ride Requests Card -->
        <div class="floating-requests-card hidden" id="requests-card">
            <div class="requests-header">
                <h3>ğŸ™‹â€â™€ï¸ Ride Requests</h3>
                <button class="close-btn" id="close-requests-btn">âœ•</button>
            </div>
            
            <div id="ride-requests-list" class="ride-requests-list">
                <!-- Ride request cards will be populated here -->
            </div>
            
            <div id="no-ride-requests" class="empty-state hidden">
                <div class="empty-icon">ğŸï¸</div>
                <h3>No ride requests yet</h3>
                <p>Wait for riders to request your ride. Requests will appear here automatically.</p>
                <div class="empty-tips">
                    <h4>ğŸ’¡ Tips to get more requests:</h4>
                    <ul>
                        <li>Set popular campus destinations</li>
                        <li>Be available during peak hours (7-9 AM, 5-7 PM)</li>
                        <li>Add a friendly message to your ride</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Floating Active Ride Card -->
        <div class="floating-active-ride hidden" id="active-ride-card">
            <div class="active-ride-header">
                <h3>ğŸï¸ Helping Community</h3>
                <div class="ride-status">In Transit</div>
            </div>
            
            <div class="ride-buddies-list" id="active-ride-buddies">
                <!-- Ride buddies will be populated dynamically -->
            </div>

            <div class="group-chat">
                <div class="chat-messages" id="active-ride-chat">
                    <!-- Chat messages will be populated dynamically -->
                </div>
            </div>

            <div class="ride-actions">
                <button class="btn btn-outline">ğŸ’¬ Group Chat</button>
                <button class="btn btn-outline">ğŸ“ Share Location</button>
                <button class="btn btn-secondary">âœ… Complete Ride</button>
            </div>

            <div class="ride-details">
                <div class="otp-display">
                    <span class="otp-label">ğŸ“± Ask rider for OTP:</span>
                    <span class="otp-code">Enter OTP to start trip</span>
                </div>
                <div class="eta-display">
                    <span class="eta-label">â±ï¸ ETA to destination:</span>
                    <span class="eta-time" id="active-ride-eta">Calculating...</span>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="status-message" class="floating-status hidden"></div>

        <!-- Loading State -->
        <div id="loading" class="floating-loading hidden">
            <div class="loading-content">
                <div class="spinner"></div>
                <span>Loading ride requests...</span>
            </div>
        </div>

        <!-- Profile Completion Modal -->
        <div id="profile-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Complete Your Helper Profile</h3>
                <p class="mb-4 text-center">Please provide your bike information to start helping the community.</p>
                
                <form id="profile-form">
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input 
                            type="tel" 
                            id="phone" 
                            class="form-input" 
                            placeholder="10-digit mobile number" 
                            maxlength="10"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="vehicle-model">Bike Model *</label>
                        <input 
                            type="text" 
                            id="vehicle-model" 
                            class="form-input" 
                            placeholder="e.g., Honda Activa, Bajaj Pulsar, TVS Apache"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="vehicle-color">Bike Color *</label>
                        <input 
                            type="text" 
                            id="vehicle-color" 
                            class="form-input" 
                            placeholder="e.g., Red, Blue, Black"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="vehicle-plate">Bike Number *</label>
                        <input 
                            type="text" 
                            id="vehicle-plate" 
                            class="form-input" 
                            placeholder="e.g., KA01AB1234"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="emergency-contact">Emergency Contact (Optional)</label>
                        <input 
                            type="tel" 
                            id="emergency-contact" 
                            class="form-input" 
                            placeholder="Emergency contact number"
                            maxlength="10"
                        >
                    </div>

                    <div class="form-group">
                        <label for="college-id">Student ID (Optional)</label>
                        <input 
                            type="text" 
                            id="college-id" 
                            class="form-input" 
                            placeholder="Your student ID number"
                        >
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">
                        ğŸ¤ Start Helping Community
                    </button>
                </form>
            </div>
        </div>

        <!-- Ride Request Modal -->
        <div id="request-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>ğŸ¤ Ride Request</h3>
                <div id="request-details" class="request-details">
                    <!-- Request details will be populated here -->
                </div>
                <div class="request-actions">
                    <button id="accept-request-btn" class="btn btn-primary btn-full">
                        âœ… Sure! Let's ride together
                    </button>
                    <button id="decline-request-btn" class="btn btn-outline btn-full mt-2">
                        âŒ Sorry, can't help this time
                    </button>
                </div>
            </div>
        </div>

        <!-- OTP Modal for Accepted Rides -->
        <div id="otp-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>ğŸ¤ Ride Accepted!</h3>
                <div id="otp-details" class="text-center mb-4">
                    <!-- OTP details will be populated here -->
                </div>
                <button id="close-otp-modal" class="btn btn-primary btn-full">
                    Got it!
                </button>
            </div>
        </div>
    </div>

    <script src="/static/js/driver_dashboard.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}&libraries=places,marker&callback=initDriverApp" async defer></script>
</body>
</html>