<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ CampusPool - Find Your Ride Buddies</title>
    <link rel="stylesheet" href="/static/css/dashboard.css">
</head>
<body>
    <div class="map-first-container">
        <!-- Full Screen Map -->
        <div id="map" class="full-screen-map"></div>
        
        <!-- Floating Header Card -->
        <div class="floating-header">
            <div class="header-content">
                <div class="user-info">
                    <h2 id="user-name">Loading...</h2>
                    <p class="user-role">ğŸŒŸ Campus Community Member</p>
                </div>
                <div class="header-actions">
                    <button class="header-btn" id="view-results-btn" title="View Ride Results">ğŸ”</button>
                    <button class="header-btn" id="notifications-btn">ğŸ’¬</button>
                    <button class="header-btn" id="profile-btn">ğŸ‘¤</button>
                    <button onclick="handleLogout()" class="logout-btn">Logout</button>
                </div>
            </div>
        </div>

        <!-- Floating Search Card -->
        <div class="floating-search-card" id="search-card">
            <div class="search-header">
                <h3>ğŸ¯ Where are you heading?</h3>
            </div>
            
            <div class="search-form">
                <div class="location-input-group">
                    <input 
                        type="text" 
                        id="pickup-input" 
                        class="location-input" 
                        placeholder="ğŸ“ From: Current location"
                        autocomplete="off"
                    >
                    <button id="current-location-btn" class="location-btn" title="Use current location">
                        ğŸ“
                    </button>
                </div>

                <div class="location-input-group">
                    <input 
                        type="text" 
                        id="destination-input" 
                        class="location-input" 
                        placeholder="ğŸ¯ To: Choose destination..."
                        autocomplete="off"
                    >
                    <button id="college-location-btn" class="location-btn" title="Set to college">
                        ğŸ«
                    </button>
                </div>

                <!-- Campus Quick Buttons -->
                <div class="campus-quick-buttons">
                    <button class="quick-btn" data-destination="ğŸ  Home">ğŸ  Home</button>
                    <button class="quick-btn" data-destination="ğŸ« College">ğŸ« College</button>
                </div>

                <div class="time-selection">
                    <label>ğŸ• When:</label>
                    <select id="ride-time" class="time-select">
                        <option value="now">Now</option>
                        <option value="15min">In 15 min</option>
                        <option value="30min">In 30 min</option>
                        <option value="1hour">In 1 hour</option>
                    </select>
                </div>

                <button id="search-rides-btn" class="btn btn-primary btn-full">
                    ğŸ” Find Ride Buddies
                </button>
                <button id="clear-search-btn" class="btn btn-outline btn-full" style="margin-top: 0.5rem;">
                    ğŸ—‘ï¸ Clear & Start Fresh
                </button>
            </div>
        </div>
        <!-- Floating Ride Results Card -->
        <div class="floating-results-card hidden" id="results-card">
            <div class="results-header">
                <h3>ğŸ¤ Available Ride Buddies</h3>
                <button class="close-btn" id="close-results-btn">âœ•</button>
            </div>
            

            <div id="ride-buddies-list" class="ride-buddies-list">
                <!-- Ride buddy cards will be populated here -->
            </div>
            
            <div id="no-ride-buddies" class="empty-state hidden">
                <div class="empty-icon">ğŸï¸</div>
                <h3>No ride buddies available</h3>
                <p>Try adjusting your pickup location or check back later. More ride buddies are usually available during peak hours.</p>
                <div class="empty-actions">
                    <button class="btn btn-outline" id="post-request-btn">ğŸ“¢ Post Ride Request</button>
                    <button class="btn btn-secondary" id="create-group-btn">âš¡ Create Group Ride</button>
                </div>
            </div>
        </div>


        <!-- Floating Active Ride Card -->
        <div class="floating-active-ride hidden" id="active-ride-card">
            <div class="active-ride-header">
                <h3>ğŸš— Ride in Progress</h3>
                <div class="ride-status">With Driver</div>
            </div>
            
            <div class="ride-buddies-list" id="active-ride-buddies">
                <!-- Ride buddies will be populated dynamically -->
            </div>

            <div class="group-chat">
                <div class="chat-messages" id="active-ride-chat">
                    <!-- Chat messages will be populated dynamically -->
                </div>
            </div>

            <div class="ride-actions">
                <button class="btn btn-outline" id="call-driver-btn">ğŸ“ Call Driver</button>
                <button class="btn btn-outline" id="share-location-btn">ğŸ“ Share Location</button>
                <button class="btn btn-outline" id="group-chat-btn">ğŸ’¬ Group Chat</button>
            </div>

            <div class="ride-details">
                <div class="otp-display">
                    <span class="otp-label">ğŸ“± Your OTP:</span>
                    <span class="otp-code" id="rider-otp-display">Loading...</span>
                </div>
                <div class="eta-display">
                    <span class="eta-label">â±ï¸ ETA to destination:</span>
                    <span class="eta-time" id="rider-eta-display">Calculating...</span>
                </div>
            </div>
        </div>

        <!-- Status Messages -->
        <div id="status-message" class="floating-status hidden"></div>

        <!-- Loading State -->
        <div id="loading" class="floating-loading hidden">
            <div class="loading-content">
                <div class="spinner"></div>
                <span>Searching for ride buddies...</span>
            </div>
        </div>

        <!-- Profile Completion Modal -->
        <div id="profile-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Complete Your Profile</h3>
                <p class="mb-4 text-center">Please provide additional information to continue using CampusPool.</p>
                
                <form id="profile-form">
                    <div class="form-group">
                        <label for="phone">Phone Number *</label>
                        <input 
                            type="tel" 
                            id="phone" 
                            class="form-input" 
                            placeholder="10-digit mobile number" 
                            maxlength="10"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="emergency-contact">Emergency Contact (Optional)</label>
                        <input 
                            type="tel" 
                            id="emergency-contact" 
                            class="form-input" 
                            placeholder="Emergency contact number"
                            maxlength="10"
                        >
                    </div>

                    <div class="form-group">
                        <label for="college-id">Student ID (Optional)</label>
                        <input 
                            type="text" 
                            id="college-id" 
                            class="form-input" 
                            placeholder="Your student ID number"
                        >
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">
                        Complete Profile
                    </button>
                </form>
            </div>
        </div>

        <!-- Ride Request Modal -->
        <div id="request-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Confirm Ride Request</h3>
                <div id="request-details">
                    <!-- Request details will be populated here -->
                </div>
                <div class="form-group">
                    <button id="confirm-request-btn" class="btn btn-primary btn-full">
                        Send Request
                    </button>
                    <button id="cancel-request-btn" class="btn btn-outline btn-full mt-2">
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Active Ride Status Modal -->
        <div id="active-ride-modal" class="modal-overlay hidden">
            <div class="modal-content">
                <h3>Ride Status</h3>
                <div id="active-ride-details">
                    <!-- Active ride details will be populated here -->
                </div>
                <div class="modal-actions">
                    <button id="close-active-ride-modal" class="btn btn-outline btn-full">
                        Close
                    </button>
                    <button id="cancel-ride-btn" class="btn btn-danger btn-full mt-2">
                        Cancel Request
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/js/rider_dashboard.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}&libraries=places,marker&callback=initRiderApp" async defer></script>
</body>
</html>